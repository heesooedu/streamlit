<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <style>
    body { margin:0; padding:0; }
    .glowscript { width: 100%; height: 100%; }
  </style>
  <!-- GlowScript 런타임 (온라인 CDN) -->
  <script type="text/javascript" src="https://www.glowscript.org/lib/glow.3.2.min.js"></script>
  <script type="text/javascript" src="https://www.glowscript.org/lib/jquery/2.1/jquery.min.js"></script>
  <script type="text/javascript" src="https://www.glowscript.org/lib/jquery/2.1/jquery-ui.custom.min.js"></script>
  <script type="text/javascript" src="https://www.glowscript.org/lib/glowscript.min.js"></script>
</head>
<body>
  <div id="glowscript" class="glowscript"></div>

  <!-- 여기에 VPython(GlowScript) Python 코드 작성 -->
  <script type="text/python">
from vpython import *

# ====== 파라미터 (Streamlit에서 치환) ======
g = __G__                 # 중력가속도 (m/s^2)
v0 = __V0__               # 초기속도 (m/s)
angle_deg = __ANGLE__     # 발사각 (deg)

# ====== 장면 설정 ======
scene.title = "Projectile (GlowScript VPython)"
scene.background = color.white
scene.width = 700
scene.height = 450
scene.center = vector(15,5,0)

# ====== 바닥/축 ======
ground = box(pos=vector(15,-0.05,0), size=vector(60,0.1,4), color=vector(0.9,0.9,0.9))
xaxis = curve(pos=[vector(0,0,0), vector(60,0,0)], color=color.gray(0.7))
yaxis = curve(pos=[vector(0,0,0), vector(0,15,0)], color=color.gray(0.7))

# ====== 투사체 ======
ball = sphere(pos=vector(0,0,0), radius=0.3, color=color.blue, make_trail=True, trail_color=color.cyan)
angle = radians(angle_deg)
v = vector(v0*cos(angle), v0*sin(angle), 0)
dt = 0.01
t = 0

# ====== 텍스트 패널 ======
label_title = label(pos=vector(30,14,0), text="측정값(실험)", box=False, height=16, color=color.black)
label_info  = label(pos=vector(30,12,0), text="", box=False, height=14, color=color.black)

# ====== 시뮬레이션 ======
ymin = 0.0
while ball.pos.y >= ymin:
    rate(200)
    # 등가속도 운동(공기저항 X)
    v = v + vector(0, -g, 0)*dt
    ball.pos = ball.pos + v*dt
    t += dt

# 지면 도달 시 사거리 계산(선형 보정)
# 마지막 스텝에서 y<0일 수 있으므로 직선보간으로 x교차점 추정
# 이전 위치로 되돌려서 보정
ball.pos = ball.pos - v*dt   # 한 스텝 되돌림
t -= dt
# y가 0이 되는 시간을 미세 조정
# vy<0이므로, y + vy*τ = 0  ->  τ = -y/vy
tau = 0.0
if v.y < 0:
    tau = ball.pos.y/(-v.y)
ball.pos = ball.pos + v*tau
t += tau

range_est = ball.pos.x
time_of_flight = t
hmax_est = (v0**2 * sin(angle)**2) / (2*g)  # 이론 최대높이 (공기저항 무시)

label_info.text = f"사거리 ≈ {range_est:.2f} m\n비행시간 ≈ {time_of_flight:.2f} s\n이론 최대높이 ≈ {hmax_est:.2f} m"

# 카메라 위치 보정
scene.center = vector(max(15, range_est/2), 5, 0)
  </script>
</body>
</html>
