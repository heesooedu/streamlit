<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <style>
    html, body { width:100%; height:100%; margin:0; padding:0; }
    #glowscript   { width:100%; height:100%; }
  </style>
  <!-- 반드시 이 순서 유지 -->
  <script src="https://www.glowscript.org/lib/jquery/2.1/jquery.min.js"></script>
  <script src="https://www.glowscript.org/lib/jquery/2.1/jquery-ui.custom.min.js"></script>
  <script src="https://www.glowscript.org/lib/glow.3.2.min.js"></script>
</head>
<body>
  <div id="glowscript"></div>

  <!-- 이 줄이 없으면 화면이 안 뜹니다 -->
  <script type="text/javascript">
    window.__context = { glowscript_container: $("#glowscript") };
  </script>

  <!-- 여기부터 GlowScript Python -->
  <script type="text/python">
from vpython import *

# ====== 파라미터 (Streamlit에서 치환) ======
g = __G__                 # 중력가속도 (m/s^2)
v0 = __V0__               # 초기속도 (m/s)
angle_deg = __ANGLE__     # 발사각 (deg)

# ====== 장면 설정 ======
scene.title = "Projectile (GlowScript VPython)"
scene.background = color.white
scene.width = 700
scene.height = 450
scene.center = vector(15,5,0)

# ====== 바닥/축 ======
ground = box(pos=vector(15,-0.05,0), size=vector(60,0.1,4), color=vector(0.9,0.9,0.9))
xaxis = curve(pos=[vector(0,0,0), vector(60,0,0)], color=color.gray(0.7))
yaxis = curve(pos=[vector(0,0,0), vector(0,15,0)], color=color.gray(0.7))

# ====== 투사체 ======
ball = sphere(pos=vector(0,0,0), radius=0.3, color=color.blue, make_trail=True, trail_color=color.cyan)
angle = radians(angle_deg)
v = vector(v0*cos(angle), v0*sin(angle), 0)
dt = 0.01
t = 0

# ====== 텍스트 패널 ======
label_title = label(pos=vector(30,14,0), text="측정값(실험)", box=False, height=16, color=color.black)
label_info  = label(pos=vector(30,12,0), text="", box=False, height=14, color=color.black)

# ====== 시뮬레이션 ======
ymin = 0.0
while ball.pos.y >= ymin:
    rate(200)
    v = v + vector(0, -g, 0)*dt
    ball.pos = ball.pos + v*dt
    t += dt

# 지면 도달 보정
ball.pos = ball.pos - v*dt
t -= dt
tau = ball.pos.y/(-v.y) if v.y < 0 else 0.0
ball.pos = ball.pos + v*tau
t += tau

range_est = ball.pos.x
time_of_flight = t
hmax_est = (v0**2 * sin(angle)**2) / (2*g)

label_info.text = f"사거리 ≈ {range_est:.2f} m\n비행시간 ≈ {time_of_flight:.2f} s\n이론 최대높이 ≈ {hmax_est:.2f} m"
scene.center = vector(max(15, range_est/2), 5, 0)
  </script>
</body>
</html>
